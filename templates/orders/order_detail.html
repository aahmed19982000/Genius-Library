{% extends base_template %}

{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/order_detail.css' %}">
{% endblock %}

{% block content %}
<div class="order-detail-container">
    <h2>تفاصيل الطلب رقم {{ order.id }}</h2>

    <table class="order-detail-table">
        <tr>
            <th>اسم العميل</th>
            <td>{{ order.customer_name }}</td>
        </tr>
        <tr>
            <th>الملف</th>
            <td>
                {% if order.file_name %}
                    <a href="{{ order.file_name.url }}" target="_blank">تحميل الملف</a>
                {% else %}
                    لا يوجد ملف
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>نوع الورق</th>
            <td>{{ order.paper_type }}</td>
        </tr>
        <tr>
            <th>حجم الورق</th>
            <td>{{ order.paper_size }}</td>
        </tr>
        <tr>
            <th>لون الطباعة</th>
            <td>{{ order.printing_color }}</td>
        </tr>
        <tr>
            <th>الطباعة على وجه/وجهين</th>
            <td>
                {% if order.printing_sides == "one side" %}
                    وجه واحد
                {% else %}
                    وجهين
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>عدد الأوراق</th>
            <td>{{ order.number_of_sheets }}</td>
        </tr>
        <tr>
            <th>عدد النسخ</th>
            <td>{{ order.quantity }}</td>
        </tr>
        <tr>
            <th>العنوان</th>
            <td>{{ order.address }}</td>
        </tr>
        <tr>
            <th>ملاحظات</th>
            <td>{{ order.notes|default:"لا توجد ملاحظات" }}</td>
        </tr>
        <tr>
            <th>إجمالي التكلفة</th>
            <td>{{ order.total_cost }} ج.م</td>
        </tr>
        <tr>
            <th>الحالة</th>
            <td>
                {% if request.user.user_type == "admin" %}
                    <form method="post" action="{% url 'update_order_status' order.id %}">
                        {% csrf_token %}
                        <select name="status" onchange="this.form.submit()" class="status-select">
                            {% for st in all_status %}
                                <option value="{{ st.id }}" {% if order.status.id == st.id %}selected{% endif %}>
                                    {{ st.status }}
                                </option>
                            {% endfor %}
                        </select>
                    </form>
                {% else %}
                    <span class="status {{ order.status|lower }}">{{ order.status }}</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>تاريخ الطلب</th>
            <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
        </tr>
        <tr>
            <th>تاريخ آخر تعديل</th>
            <td>{{ order.updated_at|date:"Y-m-d H:i" }}</td>
        </tr>
    </table>

    <div class="order-actions">
        <a href="{% url 'orderchat' order.id %}" class="btn btn-chat">فتح المحادثة</a>
        <a href="javascript:history.back()" class="btn btn-back">العودة</a>
    </div>
</div>
{% endblock %}
